name: ğŸ”„ Sync Submodules (Main)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'

permissions:
  contents: write 

jobs:
  sync-main:
    name: Update Pointers to Latest Main
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout Core
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.ADMIN_TOKEN }}
          submodules: true 
          fetch-depth: 0   

      - name: ğŸ”„ Update Submodules
        run: |

          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          echo "Atualizando todos os submÃ³dulos para a Ãºltima versÃ£o da branch MAIN remota..."
          git submodule update --remote --merge

      - name: ğŸ’¾ Commit & Push Updates
        run: |
          if [[ -n $(git status -s) ]]; then
            echo "ğŸš¨ MudanÃ§as detectadas! Os serviÃ§os (Java/C#/Infra) evoluÃ­ram."
            
            git add .
            git commit -m "chore(submodules): update references to latest main commits"
            git push
            
            echo "âœ… Core atualizado com sucesso!"
          else
            echo "ğŸ˜´ Tudo calmo. O Core jÃ¡ estÃ¡ apontando para as versÃµes mais recentes."
          fi
